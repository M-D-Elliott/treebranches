function logErrorOrDefault(c,d){c.length||(c=d),console.error(c)}String.prototype.flagString=function(c,d,f=''){return string=this.valueOf(),-1===string.indexOf(c)?d?string=c+string:(default_error=string+'is already flagged as'+c,logErrorOrDefault(f,default_error)):d?(default_error=string+'is not flagged as'+c,logErrorOrDefault(f,default_error)):string=string.replace(c,''),string};jQuery.fn.exists=function(){return 0!==this.length},jQuery.fn.extend({flagObj:function(c,d,f,g=''){for(var h=0;h<c.length;h++)attr=c[h],value=this.attr(attr),this.attr(attr,value.flagString(d,f,g=g))}});jQuery.fn.extend({classList:function(c){if(c){if(jQuery.isArray(c)){for(var d in this.attr('class',''),c)this.addClass(c[d]);return this}if('string'==typeof c)return this.attr('class','').addClass(c),this}return this.attr('class').split(/\s+/)}});jQuery.fn.extend({toggleAttr:function(c,d,f){return this.attr(c,this.attr(c)===d?f:d),this.attr(c)}});$.fn.hasAttr=function(c){return this.attr(c)!==void 0};$.fn.hasClasses=function(c){const d=this,f=c.split(' ');let g=!0;return $.each(f,function(){d.hasClass(this)||(g=!1)}),g},$.fn.hasAnyClass=function(c){const d=this,f=c.split(' ');let g=!1;return $.each(f,function(){d.hasClass(this)&&(g=!0)}),g},$.extend($.expr[':'],{block:function(c){return'block'==$(c).css('display')}}),$.extend($.expr[':'],{not_none:function(c){return'none'!=$(c).css('display')}});function lowestIndex(c){for(i=1;i<c.length+2;i++)if(!c.includes(i))return i;return console.error('No available index.'),'error'}function getQueryValues(c,d){return c.map(function(){return $(this).attr(d)}).get()}function indexOfSubstring(c,d){return indexes=[],$.each(c,function(f,g){g.match(d)&&indexes.push(f)}),indexes}function matchingSubstrings(c,d){return items=[],$.each(c,function(f,g){-1!==g.indexOf(d)&&items.push(g)}),items}function subtract(c,d){return c.split('').filter(function(f,g){return f!==d[g]}).join('')}jQuery.fn.extend({incrementAttrValue:function(c,d=''){0===d.length&&(d=this.attr(c));const f=getQueryValues(this.siblings(),c),g=matchingSubstrings(f,d);if(0<g.length){let h=[],j=!1;if($.each(g,function(k,l){let n=subtract(l,d),o=n.length;3===o&&n.match(/\([0-9]+\)/)?(h.push(parseInt(n[1])),j=!0):0===o&&(j=!0)}),j)if(h.length){let k=lowestIndex(h);d+='('+k+')'}else d+='(1)'}return this.attr(c,d),d}});const app_serial=$('#my_projects_serial').attr('data-serial'),app_icon='[class$="-icon '+app_serial+'"]',navbar_ref='.navbar';let app_color='#18FC0F';const collapsed_ref='[data-formation="collapsed"]',selected_ref='[data-selected=true].'+app_serial,project_level_ref='[data-path$="://"].'+app_serial,folder_container_ref='.folder-container',file_container_ref='.file-container',form_ref='form.'+app_serial,active_form_ref=form_ref+'.active',input_ref='.input.'+app_serial,username_ref=$('#username').text(),hidden_ref='.my-projects-page #hidden',container_icon_ref='.container-icon';let unkn_file_type='';const selector_prefix='<div data-object-id=\'',selector_suffix='\' class=\'selector pseudo-icon '+app_serial+'\'></div>';let system_folder=$();const visible='inline-flex',hidden='none';let context_menu=$(),context_menu_refs=[],temp_object_array=[],trash=$(),trash_ID='',copied_object=$(),cut_object=$(),recent_commands=[],recent_undos=[];const max_undo=3;let root_object=$(),base_path='',new_folder=$(),new_file=$(),post_form=$(),put_form=$(),delete_form=$(),rename_form=$(),copy_paste_form=$(),csrf_input=$(),csrf_token='';document.addEventListener('DOMContentLoaded',function(){trash=$('[data-ext="trash"]'),trash_ID=poundID(trash.attr('id')),system_folder=$('#system-folder.'+app_serial);const d=$(navbar_ref);app_color=d.css('background-color'),context_templates=$('.context-menu-template-wrapper.myFiles-o234a8i0'),context_templates.children().each(function(f,g){type=$(g).attr('data-type'),context_menu_refs[type]='div[data-type=\''+type+'\'].context-menu-template'}),root_object=$('[data-ext=root]'),base_path=root_object.attr('data-path'),new_folder=$('[data-name="New Folder"]'+project_level_ref),new_file=$('[data-name="New File"]'+project_level_ref),post_form=$(hidden_ref+' #post-form.'+app_serial),put_form=$(hidden_ref+' #put-form.'+app_serial),delete_form=$(hidden_ref+' #delete-form.'+app_serial),rename_form=$(hidden_ref+' #rename-form.'+app_serial),copy_paste_form=$(hidden_ref+' #copy-paste-form.'+app_serial),csrf_input=$(hidden_ref+' input[name="csrfmiddlewaretoken"]'),csrf_token=csrf_input.attr('value'),unkn_file_type='.'+new_file.find('.name-icon').text().split('.')[1]});function DirObject(c=$()){this.obj=c,this.type='',this.trashed=-1!==c.attr('data-special').indexOf('folder-')}function Folder(c=$()){DirObject.call(this,c=c),this.type='folder'}function File(c=$()){DirObject.call(this,c=c),this.type='file'}function Trash(c=$()){Folder.call(this,c=c),this.type='trash'}Folder.prototype=Object.create(DirObject.prototype),File.prototype=Object.create(DirObject.prototype),Trash.prototype=Object.create(Folder.prototype);function poundID(c){return'#'+c.replace(/\#/g,'')}function parseDirObjects(c){return('string'==typeof c&&(c=$(poundID(c))),c.is(folder_container_ref))?'trash'===c.attr('data-ext')?new Trash(c=c):new Folder(c=c):c.is(file_container_ref)?new File(c=c):(console.error('Not a valid Dir Object. Requires .folder-container or .file-container class, as well as an app_serial if protection is used.'),void 0)}DirObject.prototype.getSubObjects=function(){return[]},DirObject.prototype.getObjects=function(){return[this.obj]},DirObject.prototype.getVisiblePosition=function(){const c=this.obj,d=$('.folder-container:block, .file-container:block'),f=d.index(c);return f},DirObject.prototype.getParentId=function(){let c=this.obj.parent().attr('id');return c.match('system')?c=null:-1===c.indexOf('temp')&&(c=c.split('-')[1]),c},DirObject.prototype.flagAll=function(c,d,f,g=!1,h=''){return c instanceof Array||(c=[c]),'-'!==d.charAt(d.length-1)&&(d+='-'),(g?(this.setAllObjects(),$.each(this.getObjects(target='all'),function(j,k){$(k).flagObj(c,d,f,h=h)})):this.obj.flagObj(c,d,f,h=h),this)},Folder.prototype.getSubObjects=function(){return this.obj.find(folder_container_ref+', '+file_container_ref).map(function(c,d){return d}).toArray()},Folder.prototype.getObjects=function(c='all'){let d=[this.obj];switch(c){case'all':d=d.concat(this.getSubObjects());break;case'this':break;case'descendants':d=this.getSubObjects();break;default:console.error('Invalid target. Valid: "all", "this", or "descendants" ');}return d},Folder.prototype.getChildFolders=function(){return this.obj.children(folder_container_ref).map(function(c,d){return d}).toArray()},Folder.prototype.getChildFiles=function(){return this.obj.children(file_container_ref).map(function(c,d){return d}).toArray()},Folder.prototype.getChildObjects=function(){return this.getChildFolders().concat(this.getChildFiles())};DirObject.prototype.warnTemporary=function(c='UNKNOWN OBJECT ERROR'){return-1!==this.obj.attr('data-object-id').indexOf('temp-')&&(console.error('Action cannot be completed at this time. '+c+' is being used by another program.'),!0)},Folder.prototype.warnTemporary=function(){return name_long='Folder "'+this.obj.attr('data-name')+'"',DirObject.prototype.warnTemporary.call(this,name_long=name_long)},File.prototype.warnTemporary=function(){return name_long=this.obj.attr('data-name')+'.'+obj.attr('data-ext'),DirObject.prototype.warnTemporary.call(this,name_long=name_long)},DirObject.prototype.flagReadOnly=function(c=!1){return this.flagAll(['data-object-id'],'temp',1,c=c,error='This object is already read only.'),this},DirObject.prototype.unflagReadOnly=function(c=!1){return this.flagAll(['data-object-id'],'temp',0,c=c,error='This object is not read only.'),this},DirObject.prototype.makeTemporary=function(){obj=this.obj;var c=[];return $.each(this.getObjects(),function(d,f){item_obj=$(f),item_id=item_obj.attr('data-object-id').slice(0),index=temp_object_array.push(item_id)-1,temp_id='temp-'+index,item_obj.attr('data-object-id',temp_id).attr('id',temp_id).find('[data-object-id=\''+item_id+'\']').each(function(g,h){$(h).attr('data-object-id',temp_id)}),c.push(temp_id)}),c},DirObject.prototype.removeFromTemp=function(){var c='';return c=temp_id=this.obj.attr('id'),'temp'===temp_id.split('-')[0]?(c=temp_object_array.pop(temp_id.split('-')[1]),temp_object_array.length||(temp_object_array=[])):console.error('Object is not temporary.'),[temp_id,c]},DirObject.prototype.makePermanent=function(c=null){obj=this.obj,ids=this.removeFromTemp();var d=ids[0],f=ids[1];return null!==c&&(f=c),obj.attr('id',f).attr('data-object-id',f).find('[data-object-id=\''+d+'\']').each(function(g,h){$(h).attr('data-object-id',f)}),this};function deselectAll(){$('div.selector.myFiles-o234a8i0').remove(),$(selected_ref).attr('data-selected',!1)}DirObject.prototype.select=function(){deselectAll();const c=this.obj;c.attr('data-selected',!0);const d=c.children('.container-icon'),f=selector_prefix+c.attr('id')+selector_suffix,g=d.offset().top,h=system_folder.offset().left,j=system_folder.width(),k=d.height()+1;return $(f).appendTo(system_folder).offset({left:h,top:g}).width(j).height(k),this},DirObject.prototype.selectNeighbor=function(c,d=-1){const f=this.obj,g=$('.folder-container:not_none, .file-container:not_none'),h=g.length-1;-1===d&&(d=g.index(f));let j=d+c;j>h?j=0:0>j&&(j=h);const k=g.get(j);return parseDirObjects($(k)).select(),this},DirObject.prototype.selectNext=function(){return this.selectNeighbor(1)},DirObject.prototype.selectPrev=function(){return this.selectNeighbor(-1)};$(function(){function d(h){return /^(GET|HEAD|OPTIONS|TRACE)$/.test(h)}function f(h){var j=document.location.host,k=document.location.protocol,l='//'+j,n=k+l;return h==n||h.slice(0,n.length+1)==n+'/'||h==l||h.slice(0,l.length+1)==l+'/'||!/^(\/\/|http:|https:).*/.test(h)}var g=function(h){var j=null;if(document.cookie&&''!=document.cookie)for(var n,k=document.cookie.split(';'),l=0;l<k.length;l++)if(n=jQuery.trim(k[l]),n.substring(0,h.length+1)==h+'='){j=decodeURIComponent(n.substring(h.length+1));break}return j}('csrftoken');$.ajaxSetup({beforeSend:function(h,j){!d(j.type)&&f(j.url)&&h.setRequestHeader('X-CSRFToken',g)}})});DirObject.prototype.createDirObject=function(c='all',d=post_form.clone()){this.obj;let g=[],h=[];return this.addToRecent('create'),$.each(this.getObjects(c=c),function(j,k){const l=$(k),n=l.attr('id'),o=parseDirObjects(l),p=o.getParentId();h.push(n),g.push({user:username_ref,name:l.attr('data-name'),par_fldr:p,ext:l.attr('data-ext'),temp_id:n})}),g.push(h),d.attachData(g).submit().remove(),this},DirObject.prototype.updateDirObject=function(c='all',d=put_form.clone()){const f=this.obj;let g=[],h=[];return $.each(this.getObjects(c=c),function(j,k){const l=$(k),n=l.attr('id'),o=n.split('-')[1],p=parseDirObjects(l),q=p.getParentId();h.push(n),g.push({id:o,user:username_ref,name:l.attr('data-name'),par_fldr:q,ext:l.attr('data-ext'),special:l.attr('data-special'),sort_term:l.attr('data-sort')}),p.flagReadOnly()}),g.push(h),d.attachData(g).activateForm(f).submit().remove(),this},DirObject.prototype.deleteDirObject=function(c='all',d=delete_form.clone()){const f=this.obj,g=this.getObjects(c=c);let h=0;if(g.includes(this.obj)&&(h=-1),f.attr('data-path').match('://$')&&-1==h)console.error('Cannot delete system objects.');else{deselectAll();const j=[],k=[];let l=this.getVisiblePosition();$.each(g,function(n,o){const p=$(o),q=p.attr('id'),r=q.split('-')[1],s=parseDirObjects(p);j.push(r),k.push(q),s.flagReadOnly()}),j.push(k),d.attachData(j).activateForm(f).submit(),this.selectNeighbor(h,l=l)}return d.remove(),this},DirObject.prototype.createTo=function(c){return this.makeTemporary(),this.attachTo(c).createDirObject(),parseDirObjects(c).sort(),this},DirObject.prototype.trashOrDelete=function(c='all'){const d=this.obj;return this.trashed||d.is(trash)?this.deleteDirObject(c=c):this.moveTo(trash),this};DirObject.prototype.addToRecent=function(c,d=0){let f=[];d?f=recent_undos:(f=recent_commands,0===d&&(recent_undos=[]));let g='',h=this.obj;switch(c){case'moveTo':g=h.parent().attr('data-object-id');break;case'sortBy':g=h.attr('data-sort');break;case'rename':g=h.attr('data-name');break;default:}return f.push({obj:h,event:c,value:g}),f.length>max_undo&&(f.shift(),console.log('max write')),this};function reverseCommand(c){let d='',f=[];if(c?(d='redo',f=recent_undos):(d='undo',f=recent_commands),f.length){const g=f.pop(),h=g.obj,j=system_folder.find(h).length;if(j){const k=g.event,l=g.value;let n=parseDirObjects(g.obj);switch(k){case'create':n.deleteDirObject();break;case'moveTo':n.moveTo(l,sort=!0,c=!c);break;case'sortBy':n.sortBy(term=l,c=!c);break;case'rename':n.rename(new_name=l,c=!c);break;default:}}else reverseCommand(c)}else console.error('Nothing to '+d+'.')}function undo(){reverseCommand(0)}function redo(){reverseCommand(1)}Folder.prototype.formation=function(c){switch(obj=this.obj,c){case'collapse':obj.attr('data-form','collapsed');break;case'expand':obj.attr('data-form','expanded');break;case'toggle':obj.toggleAttr('data-form','collapsed','expanded');break;default:return console.error('Invalid command for Folder.formation()'),this;}return'collapsed'===obj.attr('data-form')?(obj.find('.file-container').css('display',hidden),obj.find('.folder-container').css('display',hidden).attr('data-form','collapsed'),obj.find('.folder-icon, .arrow-icon').each(function(g,h){item_obj=$(h),new_src=item_obj.attr('src').replace('expanded','collapsed'),item_obj.attr('src',new_src)})):(obj.children('.folder-container, .file-container').css('display',visible),obj.children(container_icon_ref).children('.folder-icon, .arrow-icon').each(function(g,h){item_obj=$(h),new_src=item_obj.attr('src').replace('collapsed','expanded'),item_obj.attr('src',new_src)})),this};Folder.prototype.sort=function(){const c=this.obj.attr('data-sort'),d=this.getChildFolders(),f=this.getChildFiles(),g=d.concat(f);let h=d.slice(0),j=f.slice(0),k=1;c.includes('-')&&(k=-1);let l=c.replace(/\-/g,'');const n=function(o){return $(o).attr('data-'+l)};return $.each([h,j],function(o,p){p.sort(function(q,r){const s=n(q),t=n(r);return t<s?1*k:t>s?-1*k:0})}),$.each(g,function(o,p){$(p).remove()}),this.obj.append(h.concat(j)),this},Folder.prototype.sortBy=function(c='',d=0){this.addToRecent('sortBy',d=d);const f=this.obj,g=this.obj.attr('data-sort');c.length||(c=g.replace(/\-/g,''));return g.includes(c)&&!g.includes('-')?f.attr('data-sort','-'+c):f.attr('data-sort',c),this.sort().updateDirObject(target='this'),this},File.prototype.sort=function(){return parseDirObjects(this.obj.parent()).sort(),this},File.prototype.sortBy=function(c=''){return parseDirObjects(this.obj.parent()).sortBy(c=c),this};Trash.prototype.empty=function(){const c=this.getChildObjects().length;return c?DirObject.prototype.deleteDirObject.call(this,target='descendants'):console.log('Trash is empty.'),this},Trash.prototype.deleteDirObject=function(c='trashed objects'){return this.empty()};DirObject.prototype.restore=function(){const c=this.obj,d=c.attr('data-special');return this.moveTo(d),c.attr('data-special',''),this};DirObject.prototype.openContextMenu=function(c){const d=this.obj;d.attr('data-path').match('://$')?'trash'===d.attr('data-ext')?context_menu=$(context_menu_refs.trash).clone():context_menu=$(context_menu_refs.root).clone():-1===d.attr('data-special').indexOf('folder-')?d.is(folder_container_ref)?context_menu=$(context_menu_refs.folder).clone():d.is(file_container_ref)&&(context_menu=$(context_menu_refs.file).clone()):context_menu=$(context_menu_refs['in-trash']).clone();const f=d.children('.container-icon'),g=f.height(),h=f.offset().top+1/2*g,j=c.pageX,k=$('<div class=\'context-wrapper\'>');return context_menu.removeClass('context-menu-template').attr('id','context-menu').appendTo(k),k.appendTo(system_folder).offset({top:h,left:j}),this};DirObject.prototype.attachTo=function(c,d=!0){const f=this.obj;c instanceof DirObject||(c=parseDirObjects(c));const g=c.obj,h=g.attr('data-path')+g.attr('id')+'/';return f.appendTo(g).attr('data-path',h),'collapsed'===g.attr('data-form')?(f.css('display',hidden),c.select()):(f.css('display',visible),this.select()),(d&&c.sort(),this)},Folder.prototype.attachTo=function(c,d=!0){return this.formation('collapse'),DirObject.prototype.attachTo.call(this,c,d=d)},DirObject.prototype.moveTo=function(c,d=!0,f=0){const g=this.obj,h=g.attr('id');if(c instanceof DirObject||(c=parseDirObjects(c)),void 0===c)console.error('Folder does not exist.');else{const j=c.obj,k=g.parent(),l=k.attr('id'),n=j.attr('id');c instanceof Folder?$.contains(g.get(0),j.get(0))||h==n?console.error('Cannot create cyclical folders.'):j===new_folder?console.error('Objects cannot be placed in template.'):g.attr('data-path').match('://$')?console.error('Cannot move system folders.'):(this.addToRecent('moveTo',f=f).attachTo(c,d=d),j.is(trash)?g.attr('data-special',l):k.is(trash)&&g.attr('data-special',''),this.changeName().updateDirObject()):console.error('target base folder is not a folder.')}return this};DirObject.prototype.addObject=function(c,d=this){d.formation('expand');var f=$();f='file'===c?new_file:new_folder;var g=parseDirObjects(f.clone());return g.makeTemporary(),g.attachTo(d.obj,sort=!1).openFormField(post_form),this},File.prototype.addObject=function(c){return target=parseDirObjects(this.obj.parent()),DirObject.prototype.addObject.call(this,c,target=target)},Trash.prototype.addObject=function(c){return console.error('Cannot add '+c+'s to trash bin.'),this};DirObject.prototype.changeName=function(c=''){const d=this.obj,f=d.children(container_icon_ref).children('.name-icon');c=d.incrementAttrValue('data-name',value=c);let g=c;return d.is(folder_container_ref)?g+=':':-1===c.indexOf('.')&&(g+=unkn_file_type),f.html('&nbsp;'+g),parseDirObjects(this.obj.parent()).sort(),this},DirObject.prototype.rename=function(c='',d=0,f=rename_form.clone()){return this.addToRecent('rename',d=d).changeName(c=c).updateDirObject(target='this',f=f),this};function removePreviousClipboard(){copied_object.length&&(parseDirObjects(copied_object).removeFromTemp(),copied_object=$());cut_object=$()}DirObject.prototype.cut=function(){const c=this.obj;return c.attr('data-path').match('://$')||(removePreviousClipboard(),cut_object=c),this},DirObject.prototype.copy=function(){return obj=this.obj,obj.attr('data-path').match('://$')||(removePreviousClipboard(),copied_object=obj.clone(),parseDirObjects(copied_object).makeTemporary()),this},Folder.prototype.pasteHere=function(){if(cut_object.length){const c=parseDirObjects(cut_object);c.moveTo(this),removePreviousClipboard()}else if(copied_object.length){const c=copied_object.clone(),d=parseDirObjects(c),f=c.children('.container-icon').children('.name-icon');let g=copy_paste_form.clone();g.activateForm(f),d.makeTemporary(),d.attachTo(this.obj).createDirObject(target='all',g=g)}else console.error('No paste object.');return this},File.prototype.pasteHere=function(){return parseDirObjects(this.obj.parent()).pasteHere(),this};$.fn.show=function(){return'block'===this.css('display')?this.css('display','none'):this.css('display','block'),this};function showNewFolder(){new_folder.show()}function showNewFile(){new_file.show()}function deleteDirObject(c){dir_object=parseDirObjects($(c)),dir_object.obj.attr('data-special','trashed'),dir_object.deleteDirObject(delete_form.clone(),many=!0,force=!0)}function deleteRoot(){deleteDirObject('[data-ext=root]')}function deleteTrash(){deleteDirObject('[data-ext=trash]')}function deleteSystemFolders(){return deleteRoot(),deleteTrash(),'System folders removed.'}jQuery.fn.extend({activateForm:function(c){if(this.is('form')){const d=c.offset(),f=c.attr('data-object-id');this.appendTo(c).offset({top:d.top,left:d.left}).attr('data-object-ID',f).addClass('active').children('.form-input').focus()}else console.error('Cannot activate a non-form element.');return this}}),jQuery.fn.extend({attachData:function(c){return this.is('form')?this.children('#data').attr('value',JSON.stringify(c)):console.error('Cannot attach data to a non-form element.'),this}}),DirObject.prototype.openFormField=function(c){const d=c.clone(),f=this.obj.children('.container-icon'),g=f.children('.name-icon');d.activateForm(g)};function finalizeFormFields(){let c=$(active_form_ref);if(0!==c.length){var d=c.find('.form-input');if(d.exists()){var f=parseDirObjects(c.attr('data-object-ID'));return-1===c.attr('onsubmit').indexOf('Post')?-1!==c.attr('onsubmit').indexOf('Put')&&f.rename(new_name=d.val(),direction=0,c=c):f.changeName(new_name=d.val()).createDirObject(target='this',c=c),!0}}return!1}DirObject.prototype.runCommand=function(c){c=c.split('-');let d=c.pop().toLowerCase();switch(c=c.toString().toLowerCase(),''===c&&(c=d,d=''),(obj_is_temporary=this.warnTemporary(),c)){case'collapse':this.formation('collapse');break;case'expand':this.formation('expand');break;case'open':if(obj_is_temporary)break;;this.open();break;case'rename':if(obj_is_temporary)break;;this.openFormField(rename_form.clone());break;case'delete':if(obj_is_temporary)break;;this.trashOrDelete();break;case'cut':if(obj_is_temporary)break;;this.cut();break;case'copy':if(obj_is_temporary)break;;this.copy();break;case'paste':if(obj_is_temporary)break;;this.pasteHere();break;case'new folder':if(obj_is_temporary)break;;this.addObject('folder');break;case'new file':if(obj_is_temporary)break;;this.addObject('file');break;case'empty trash':this.empty();break;case'properties':this.properties();break;case'sort':this.sortBy(term=d);break;case'restore':this.restore();break;default:console.error('Unknown command. Check string value.');}return this};submitPost=function(c){const d=c.data.value;return $.ajax({url:'',type:'POST',data:{csrfmiddlewaretoken:csrf_token,data:d},success:function(f){const g=f.temp_ids,h=f.return_ids;$.each(g,function(j,k){parseDirObjects(k).makePermanent(new_id=h[j])})},error:function(){temp_ids=JSON.parse(d).pop(),$.each(temp_ids,function(j,k){dir_obj=parseDirObjects(k),dir_obj.removeFromTemp(),dir_obj.obj.remove()})}}),!1},submitPut=function(c){const d=c.data.value;return $.ajax({url:'',type:'PUT',data:{csrfmiddlewaretoken:csrf_token,data:d},success:function(f){const g=f.return_ids;$.each(g,function(h,j){parseDirObjects(j).unflagReadOnly()})},error:function(f){console.log(f.responseText);const j=JSON.parse(d).pop();$.each(j,function(k,l){parseDirObjects(l).unflagReadOnly()})}}),!1},submitDelete=function(c){return data=c.data.value,$.ajax({url:'',type:'DELETE',data:{csrfmiddlewaretoken:csrf_token,data:data},success:function(d){const f=d.return_ids.reverse();$.each(f,function(g,h){$('#'+h).remove()})},error:function(){const h=JSON.parse(data).pop();$.each(h,function(j,k){parseDirObjects(k).unflagReadOnly()})}}),!1};document.addEventListener('DOMContentLoaded',function(){const d=parseDirObjects($(root_object)),f=$(document);f.on('dblclick mousedown',function(g){const h=$(g.target);if(context_menu.remove(),finalizeFormFields(),h.is(app_icon)){g.preventDefault();const j=h.is('.menu-icon');let k=h;j&&(k=$(selected_ref));const l=k.attr('data-object-id'),n=parseDirObjects(l),o=n.trashed;if(n.select(),1!==g.which)3===g.which&&'mousedown'===g.type&&(j||h.hasClass('arrow-icon')||n.openContextMenu(g));else if('dblclick'===g.type){if('folder'===n.type&&!o){h.hasAnyClass('folder-icon name-icon')&&n.formation('toggle')}else'file'!==n.type||o||(file=n,file.open());}else if('mousedown'===g.type)if(h.hasClass('arrow-icon')&&!o){n.formation('toggle')}else j&&(command=h.text(),n.runCommand(command))}else deselectAll()}),f.on('keydown',function(g){const h=g||window.event,j=h.keyCode||h.which,k=$(selected_ref);if(context_menu.remove(),0!==$(active_form_ref).length)13===j||3===j||37===j||38===j||39===j||40===j?(g.preventDefault(),finalizeFormFields()):void 0;else if(g.preventDefault(),k.length){const l=parseDirObjects(k),n=l.trashed;switch(j){case 13:case 3:if(!n){const o=l.type;if('folder'===o||'trash'===o){l.formation('toggle')}else if('file'===o){l.open()}};break;case 37:case 38:l.selectPrev();break;case 39:case 40:l.selectNext();break;case 46:l.trashOrDelete();break;case 78:n||l.addObject('folder');;break;case 70:n||l.addObject('file');;break;case 82:n?l.restore():l.openFormField(rename_form);;break;case 83:n||l.sortBy();;break;case 67:!n&&g.ctrlKey&&l.copy();;break;case 86:!n&&g.ctrlKey&&l.pasteHere();;break;case 88:g.ctrlKey&&l.cut();;break;case 89:g.ctrlKey&&redo();;break;case 90:g.ctrlKey&&(g.shiftKey?redo():undo());;break;default:}}else switch(j){case 37:case 38:case 39:case 40:d.select();break;case 89:g.ctrlKey&&redo();;break;case 90:g.ctrlKey&&(g.shiftKey?redo():undo());;break;default:}})});